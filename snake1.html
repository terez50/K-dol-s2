<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake</title>
</head>
<body>
    <canvas id="canvas" width="1024" height="1024"></canvas><br>
    <input type="button" onclick="rajzol()" value="Rajzol"><br>
    <input type="button" onclick="torol()" value="Töröl"><br>
</body>
<script>
    var jatek = {
        tickSzama: 0,
        idozito: null,
        tabla: [
            "###############",
            "#             #",
            "#             #",
            "#             #",
            "#    ####     #",
            "#    ####     #",
            "#             #",
            "#             #",
            "#             #",
            "###############"
        ],
        tick: function() {
            window.clearTimeout(jatek.idozito);
            jatek.tickSzama++;
            kigyo.mozgas();
            grafika.jatekMegrajzolas();
            jatek.idozito = window.setTimeout("jatek.tick()", 500);
        },
        uresNegyzet: function(hely) {
            return jatek.tabla[hely.y][hely.x] == " ";
        }
    };

    var kigyo = {
        reszek: [
            {x: 4, y: 2},
            {x: 3, y: 2},
            {x: 2, y: 2}
        ],
        irany: "E",
        kovetkezoHely: function() {
            var kigyoFej = kigyo.reszek[0];
            var celX = kigyoFej.x;
            var celY = kigyoFej.y;
            celY = kigyo.irany == "N" ? celY - 1 : celY;
            celY = kigyo.irany == "S" ? celY + 1 : celY;
            celX = kigyo.irany == "W" ? celX - 1 : celX;
            celX = kigyo.irany == "E" ? celX + 1 : celX;
            return {x: celX, y: celY};
        },
        mozgas: function() {
            var hely = kigyo.kovetkezoHely();
            if(jatek.uresNegyzet(hely)) {
                kigyo.reszek.unshift(hely);
                kigyo.reszek.pop();
            }
        }
    };

    var grafika = {
        canvas: document.getElementById("canvas"),
        negyzetMeret: 30,
        tablaMegrajzolas: function(ctx) {
            var aktualisYoffset = 0;
            jatek.tabla.forEach(function sorEllenorzes(sor) {
                sor = sor.split("");
                var aktualisXoffset = 0;
                sor.forEach(function karakterEllenorzes(karakter) {
                    if (karakter == "#") {
                        ctx.fillStyle = "black";
                        ctx.fillRect(aktualisXoffset, aktualisYoffset, grafika.negyzetMeret, grafika.negyzetMeret);
                    }
                    aktualisXoffset += grafika.negyzetMeret;
                });
                aktualisYoffset += grafika.negyzetMeret;
            }); 
        },
        kigyoMegrajzolas: function(ctx) {
            kigyo.reszek.forEach(function reszMegrajzolas(resz) {
                var reszXhelye = resz.x * grafika.negyzetMeret;
                var reszYhelye = resz.y * grafika.negyzetMeret;
                console.log("reszXhelye:", reszXhelye, "reszYhelye:", reszYhelye)
                ctx.fillStyle = "green";
                ctx.fillRect(reszXhelye, reszYhelye, grafika.negyzetMeret, grafika.negyzetMeret)
            });
        },
        jatekMegrajzolas: function() {
            var ctx = grafika.canvas.getContext("2d");
            ctx.clearRect(0,0,grafika.canvas.width,grafika.canvas.height);
            grafika.tablaMegrajzolas(ctx);
            grafika.kigyoMegrajzolas(ctx);
        }
    };
    grafika.jatekMegrajzolas();
    var jatekIranyitas = {
        beviteliEsemeny: function(lenyomottBillentyu) {
            var key = lenyomottBillentyu.key.toLowerCase();
            var celIrany = kigyo.irany;
            if(key=="w") celIrany = "N";
            if(key=="a") celIrany = "W";
            if(key=="s") celIrany = "S";
            if(key=="d") celIrany = "E";
            kigyo.irany = celIrany;
            jatek.tick();
        },
        jatekInditas: function() {
            window.addEventListener("keypress", jatekIranyitas.beviteliEsemeny, false);
            jatek.tick();
        }
    };
    jatekIranyitas.jatekInditas();
</script>
</html>